# automatic-tsr-quantification-for-pdac

## Table of Contents
- [Installation](#installation)
- [Inference](#inference)
- [Training a new model](#training)
- [Example results](#example)

## Installation
1. Clone the repository
   ```bash
   git clone https://github.com/DIAGNijmegen/automatic-tsr-quantification-for-pdac.git
   ```

 2. Build the docker.
 3. Run the docker
 4. Download weights
```bash
    pip install gdown
    gdown --folder https://drive.google.com/drive/folders/1LzGj7nmuYVQwjcxFvUW7Zny3V1M-f6mM?usp=drive_link
```

## Inference
To apply inference on data iterate through the following steps:
1. Modify code/schedule_tumor_characterization.sh so that the script can see the path to your images.
2. Modify code/run_all_automatic_tsr.sh with the same input paths.
```bash
    bash source/code/schedule_tumor_characterization.sh
```

## Training a new model
To train a model from scratch, assuming input images and masks are available, follow these steps:
1. Create a network_configuration.yaml (following the example from code/network_configuration.yaml
2. Create a dataset:
```python
    python3 source/pathology-common/scripts/createdataconfig.py --output "path/to/dataset.yaml" --images "/path/to/image/folder" --masks "/path/to/mask/folder" --labels [labels, in, the, mask] --spacing "2.0" (--random)
labels is a list of integers representing the values in the mask (i.e. 0 = background, 1 = tissue, 2 = tumor)
```
3. Create splits:
```python
    python3 source/pathology-common/scripts/createfoldsg.py --input "path/to/dataset.yaml" --output "/path/to/folds" --folds "x" (--overwrite)
x is an integer representing the number of folds you want to create (i.e. 5)
```
3. Modify code/pytorch_run_experiment.sh by adding your wandb login token, specifiying a project name and passing the appropriate files, where data_path represents one single split (i.e. fold_0) previously created.
4. Run the training script:
```bash
    bash source/code/pytorch_run_experiment.sh
```
5. After is finished, run it as many times as many folds you have created.

## Example results
Here a set of images with results generated by the trained networks.

  





